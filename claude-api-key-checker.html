<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude API Key ìƒíƒœ ì²´í¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .status-box {
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid;
        }

        .status-loading {
            background: #e3f2fd;
            border-left-color: #2196F3;
            color: #0d47a1;
        }

        .status-success {
            background: #e8f5e9;
            border-left-color: #4CAF50;
            color: #1b5e20;
        }

        .status-error {
            background: #ffebee;
            border-left-color: #f44336;
            color: #b71c1c;
        }

        .status-warning {
            background: #fff3e0;
            border-left-color: #ff9800;
            color: #e65100;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .info-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
        }

        .info-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .key-display {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }

        .detail-item {
            padding: 12px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
        }

        .detail-value {
            color: #333;
        }

        .usage-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .usage-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”‘ Claude API Key ìƒíƒœ ì²´í¬</h1>
            <p>í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ API í‚¤ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
        </div>

        <!-- ì €ì¥ëœ í‚¤ í™•ì¸ -->
        <div class="card">
            <div class="card-title">ğŸ’¾ ì €ì¥ëœ API í‚¤</div>
            
            <div id="savedKeySection"></div>

            <button class="btn btn-primary" onclick="checkSavedKey()">
                ğŸ” ì €ì¥ëœ í‚¤ í™•ì¸í•˜ê¸°
            </button>
        </div>

        <!-- API í‚¤ ìƒíƒœ ì²´í¬ -->
        <div class="card">
            <div class="card-title">ğŸ§ª API í‚¤ ìƒíƒœ í…ŒìŠ¤íŠ¸</div>
            
            <div class="alert alert-info">
                <strong>ğŸ’¡ í…ŒìŠ¤íŠ¸ ë‚´ìš©</strong>
                <p style="margin-top: 8px;">
                    â€¢ API í‚¤ ìœ íš¨ì„± í™•ì¸<br>
                    â€¢ ê³„ì • í¬ë ˆë”§ ì”ì•¡ í™•ì¸ (ê°€ëŠ¥í•œ ê²½ìš°)<br>
                    â€¢ Rate Limit ìƒíƒœ í™•ì¸<br>
                    â€¢ ì‘ë‹µ ì†ë„ ì¸¡ì •
                </p>
            </div>

            <button class="btn btn-success" onclick="testApiKey()">
                â–¶ï¸ API í‚¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            </button>

            <div id="testResult"></div>
        </div>

        <!-- ìƒì„¸ ì •ë³´ -->
        <div class="card" id="detailsCard" style="display: none;">
            <div class="card-title">ğŸ“Š ìƒì„¸ ì •ë³´</div>
            <div id="detailsContent"></div>
        </div>

        <!-- ì‚¬ìš©ëŸ‰ ì¶”ì • -->
        <div class="card" id="usageCard" style="display: none;">
            <div class="card-title">ğŸ“ˆ ì‚¬ìš©ëŸ‰ ì¶”ì •</div>
            <div id="usageContent"></div>
        </div>
    </div>

    <script>
        let savedApiKey = '';

        // ì €ì¥ëœ í‚¤ í™•ì¸
        function checkSavedKey() {
            const section = document.getElementById('savedKeySection');
            savedApiKey = localStorage.getItem('api_key') || '';

            if (!savedApiKey) {
                section.innerHTML = `
                    <div class="status-box status-warning">
                        <strong>âš ï¸ ì €ì¥ëœ API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤</strong>
                        <p style="margin-top: 10px;">
                            âš™ï¸ ì„¤ì • íƒ­ì—ì„œ API í‚¤ë¥¼ ë¨¼ì € ì €ì¥í•˜ì„¸ìš”.
                        </p>
                    </div>
                `;
                return;
            }

            // í‚¤ ë§ˆìŠ¤í‚¹ (ì• 10ì, ë’¤ 4ìë§Œ í‘œì‹œ)
            const maskedKey = savedApiKey.substring(0, 10) + 
                             '...' + 
                             savedApiKey.substring(savedApiKey.length - 4);

            section.innerHTML = `
                <div class="status-box status-success">
                    <strong>âœ… API í‚¤ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤</strong>
                    <div class="key-display">${maskedKey}</div>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        ì „ì²´ í‚¤ ê¸¸ì´: ${savedApiKey.length}ì
                    </p>
                </div>
            `;
        }

        // API í‚¤ í…ŒìŠ¤íŠ¸
        async function testApiKey() {
            const resultDiv = document.getElementById('testResult');
            
            if (!savedApiKey) {
                savedApiKey = localStorage.getItem('api_key') || '';
            }

            if (!savedApiKey) {
                resultDiv.innerHTML = `
                    <div class="status-box status-error">
                        <strong>âŒ API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤</strong>
                        <p style="margin-top: 10px;">ë¨¼ì € "ì €ì¥ëœ í‚¤ í™•ì¸í•˜ê¸°"ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            // ë¡œë”© í‘œì‹œ
            resultDiv.innerHTML = `
                <div class="status-box status-loading">
                    <div class="loading">
                        <div class="spinner"></div>
                        <strong>ğŸ” API í‚¤ í…ŒìŠ¤íŠ¸ ì¤‘...</strong>
                        <p style="margin-top: 10px; font-size: 0.9rem;">
                            ì¸ì¦ í™•ì¸ â†’ ì‘ë‹µ í…ŒìŠ¤íŠ¸ â†’ ìƒíƒœ ë¶„ì„
                        </p>
                    </div>
                </div>
            `;

            const startTime = Date.now();

            try {
                // API í˜¸ì¶œ
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': savedApiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 50,
                        messages: [{
                            role: 'user',
                            content: 'API í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. "ì •ìƒ ì‘ë™"ì´ë¼ê³ ë§Œ ë‹µë³€í•˜ì„¸ìš”.'
                        }]
                    })
                });

                const endTime = Date.now();
                const responseTime = endTime - startTime;

                // ì‘ë‹µ í—¤ë”ì—ì„œ Rate Limit ì •ë³´ ì¶”ì¶œ
                const rateLimitHeaders = {
                    requestsLimit: response.headers.get('anthropic-ratelimit-requests-limit'),
                    requestsRemaining: response.headers.get('anthropic-ratelimit-requests-remaining'),
                    requestsReset: response.headers.get('anthropic-ratelimit-requests-reset'),
                    tokensLimit: response.headers.get('anthropic-ratelimit-tokens-limit'),
                    tokensRemaining: response.headers.get('anthropic-ratelimit-tokens-remaining'),
                    tokensReset: response.headers.get('anthropic-ratelimit-tokens-reset')
                };

                const data = await response.json();

                if (response.ok) {
                    // ì„±ê³µ
                    resultDiv.innerHTML = `
                        <div class="status-box status-success">
                            <strong>âœ… API í‚¤ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!</strong>
                            
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">ìƒíƒœ</div>
                                    <div class="info-value" style="color: #4CAF50;">ì •ìƒ</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">ì‘ë‹µ ì‹œê°„</div>
                                    <div class="info-value">${responseTime}ms</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">ëª¨ë¸</div>
                                    <div class="info-value">${data.model}</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">í† í° ì‚¬ìš©</div>
                                    <div class="info-value">${data.usage.input_tokens + data.usage.output_tokens}</div>
                                </div>
                            </div>

                            <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                                API ì‘ë‹µ: "${data.content[0].text}"
                            </p>
                        </div>
                    `;

                    // ìƒì„¸ ì •ë³´ í‘œì‹œ
                    showDetails(data, rateLimitHeaders, responseTime);
                    
                    // ì‚¬ìš©ëŸ‰ ì •ë³´ í‘œì‹œ
                    showUsage(data.usage, rateLimitHeaders);

                } else {
                    // ì—ëŸ¬ ì²˜ë¦¬
                    handleError(response, data, responseTime);
                }

            } catch (error) {
                // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
                resultDiv.innerHTML = `
                    <div class="status-box status-error">
                        <strong>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</strong>
                        <p style="margin-top: 10px;">
                            <strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong> ${error.message}
                        </p>
                        <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                            <strong>ê°€ëŠ¥í•œ ì›ì¸:</strong><br>
                            â€¢ ì¸í„°ë„· ì—°ê²° ëŠê¹€<br>
                            â€¢ ë°©í™”ë²½ ì°¨ë‹¨<br>
                            â€¢ VPN ë¬¸ì œ<br>
                            â€¢ CORS ì˜¤ë¥˜
                        </p>
                    </div>
                `;
            }
        }

        // ì—ëŸ¬ ì²˜ë¦¬
        function handleError(response, data, responseTime) {
            const resultDiv = document.getElementById('testResult');
            let errorTitle = '';
            let errorDetail = '';
            let solution = '';

            if (data.error) {
                switch(data.error.type) {
                    case 'authentication_error':
                        errorTitle = 'ğŸ” ì¸ì¦ ì˜¤ë¥˜';
                        errorDetail = 'API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                        solution = `
                            <strong>í•´ê²° ë°©ë²•:</strong><br>
                            1. <a href="https://console.anthropic.com/settings/keys" target="_blank">console.anthropic.com</a>ì—ì„œ í‚¤ í™•ì¸<br>
                            2. í‚¤ê°€ Active ìƒíƒœì¸ì§€ í™•ì¸<br>
                            3. ìƒˆ í‚¤ ìƒì„± í›„ ì¬ì…ë ¥
                        `;
                        break;

                    case 'permission_error':
                        errorTitle = 'â›” ê¶Œí•œ ì˜¤ë¥˜';
                        errorDetail = 'API í‚¤ì— í•„ìš”í•œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.';
                        solution = `
                            <strong>í•´ê²° ë°©ë²•:</strong><br>
                            1. API í‚¤ ê¶Œí•œ í™•ì¸<br>
                            2. ìƒˆ í‚¤ ìƒì„± (ëª¨ë“  ê¶Œí•œ ë¶€ì—¬)<br>
                            3. ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ í‚¤ ì œê±° í›„ ì¬ì‚¬ìš©
                        `;
                        break;

                    case 'rate_limit_error':
                        errorTitle = 'â±ï¸ Rate Limit ì´ˆê³¼';
                        errorDetail = 'ë„ˆë¬´ ë§ì€ ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.';
                        solution = `
                            <strong>í•´ê²° ë°©ë²•:</strong><br>
                            1. 1-2ë¶„ ëŒ€ê¸° í›„ ì¬ì‹œë„<br>
                            2. ìš”ì²­ ë¹ˆë„ ì¤„ì´ê¸°<br>
                            3. ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš© ì¤‘ì´ë¼ë©´ ëŒ€ê¸°
                        `;
                        break;

                    case 'invalid_request_error':
                        errorTitle = 'âŒ ìš”ì²­ ì˜¤ë¥˜';
                        errorDetail = data.error.message;
                        solution = 'ìš”ì²­ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”.';
                        break;

                    default:
                        errorTitle = 'âŒ API ì˜¤ë¥˜';
                        errorDetail = data.error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                        solution = 'ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
                }
            } else if (response.status === 402) {
                errorTitle = 'ğŸ’³ í¬ë ˆë”§ ë¶€ì¡±';
                errorDetail = 'API í¬ë ˆë”§ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.';
                solution = `
                    <strong>í•´ê²° ë°©ë²•:</strong><br>
                    1. <a href="https://console.anthropic.com/settings/billing" target="_blank">Billing í˜ì´ì§€</a> í™•ì¸<br>
                    2. Credits ì”ì•¡ í™•ì¸<br>
                    3. Buy Creditsë¡œ ì¶©ì „
                `;
            } else {
                errorTitle = 'âŒ HTTP ' + response.status;
                errorDetail = response.statusText;
                solution = 'API ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.';
            }

            resultDiv.innerHTML = `
                <div class="status-box status-error">
                    <strong>${errorTitle}</strong>
                    <p style="margin-top: 10px;">
                        ${errorDetail}
                    </p>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.5); border-radius: 8px;">
                        ${solution}
                    </div>
                    <div class="info-grid" style="margin-top: 15px;">
                        <div class="info-item">
                            <div class="info-label">HTTP ìƒíƒœ</div>
                            <div class="info-value" style="color: #f44336;">${response.status}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ì‘ë‹µ ì‹œê°„</div>
                            <div class="info-value">${responseTime}ms</div>
                        </div>
                    </div>
                    ${data.error ? `
                        <p style="margin-top: 15px; font-size: 0.85rem; color: #999; font-family: monospace;">
                            Error Type: ${data.error.type}
                        </p>
                    ` : ''}
                </div>
            `;

            document.getElementById('detailsCard').style.display = 'none';
            document.getElementById('usageCard').style.display = 'none';
        }

        // ìƒì„¸ ì •ë³´ í‘œì‹œ
        function showDetails(data, rateLimitHeaders, responseTime) {
            const card = document.getElementById('detailsCard');
            const content = document.getElementById('detailsContent');

            let html = '';

            // ê¸°ë³¸ ì •ë³´
            html += `
                <div class="detail-item">
                    <span class="detail-label">âœ… API ìƒíƒœ</span>
                    <span class="detail-value" style="color: #4CAF50; font-weight: 600;">ì •ìƒ ì‘ë™</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸš€ ëª¨ë¸</span>
                    <span class="detail-value">${data.model}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">â±ï¸ ì‘ë‹µ ì‹œê°„</span>
                    <span class="detail-value">${responseTime}ms</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸ“ Stop Reason</span>
                    <span class="detail-value">${data.stop_reason}</span>
                </div>
            `;

            // Rate Limit ì •ë³´
            if (rateLimitHeaders.requestsLimit) {
                html += `
                    <h4 style="margin: 20px 0 10px; color: #555;">ğŸ“Š Rate Limit ì •ë³´</h4>
                    <div class="detail-item">
                        <span class="detail-label">ìš”ì²­ ì œí•œ</span>
                        <span class="detail-value">${rateLimitHeaders.requestsRemaining} / ${rateLimitHeaders.requestsLimit}</span>
                    </div>
                `;
                
                if (rateLimitHeaders.requestsReset) {
                    const resetDate = new Date(rateLimitHeaders.requestsReset);
                    html += `
                        <div class="detail-item">
                            <span class="detail-label">ë¦¬ì…‹ ì‹œê°„</span>
                            <span class="detail-value">${resetDate.toLocaleString('ko-KR')}</span>
                        </div>
                    `;
                }
            }

            content.innerHTML = html;
            card.style.display = 'block';
        }

        // ì‚¬ìš©ëŸ‰ ì •ë³´ í‘œì‹œ
        function showUsage(usage, rateLimitHeaders) {
            const card = document.getElementById('usageCard');
            const content = document.getElementById('usageContent');

            const totalTokens = usage.input_tokens + usage.output_tokens;

            let html = `
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">ì…ë ¥ í† í°</div>
                        <div class="info-value">${usage.input_tokens}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì¶œë ¥ í† í°</div>
                        <div class="info-value">${usage.output_tokens}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì´ í† í°</div>
                        <div class="info-value">${totalTokens}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ì˜ˆìƒ ë¹„ìš©</div>
                        <div class="info-value">$${estimateCost(usage).toFixed(4)}</div>
                    </div>
                </div>
            `;

            // Rate Limit ì§„í–‰ë¥ 
            if (rateLimitHeaders.requestsLimit && rateLimitHeaders.requestsRemaining) {
                const usedPercent = ((rateLimitHeaders.requestsLimit - rateLimitHeaders.requestsRemaining) / rateLimitHeaders.requestsLimit * 100).toFixed(1);
                html += `
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-weight: 600;">Rate Limit ì‚¬ìš©ë¥ </span>
                            <span>${usedPercent}%</span>
                        </div>
                        <div class="usage-bar">
                            <div class="usage-fill" style="width: ${usedPercent}%"></div>
                        </div>
                        <p style="margin-top: 8px; font-size: 0.85rem; color: #666;">
                            ${rateLimitHeaders.requestsRemaining}íšŒ ë‚¨ìŒ (ì´ ${rateLimitHeaders.requestsLimit}íšŒ)
                        </p>
                    </div>
                `;
            }

            content.innerHTML = html;
            card.style.display = 'block';
        }

        // ë¹„ìš© ì¶”ì • (Claude Sonnet 4 ê¸°ì¤€)
        function estimateCost(usage) {
            const inputCost = usage.input_tokens / 1000000 * 3.0;  // $3 per MTok
            const outputCost = usage.output_tokens / 1000000 * 15.0;  // $15 per MTok
            return inputCost + outputCost;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì²´í¬
        document.addEventListener('DOMContentLoaded', () => {
            checkSavedKey();
        });
    </script>
</body>
</html>